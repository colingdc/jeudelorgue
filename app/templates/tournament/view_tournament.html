{% extends "base.html" %}

{% block content %}

<div class="panel panel-default">

    <div class="panel-heading">
        <h3 class="panel-title"><strong>Tournoi {{ tournament.name }}</strong></h3>
    </div>

    <div class="panel-body">
        <div class="row">
            <ul class="col-md-3">
                <li>{{ tournament.number_rounds }} tours</li>
                <li>
                    {% if tournament.is_open_to_registration() %}
                    <p>Date limite d'inscription :</p>
                    <p>{{ tournament.started_at }}</p>
                    {% elif not tournament.is_visible() %}
                    Inscriptions non ouvertes
                    {% else %}
                    Inscriptions closes
                    {% endif %}
                </li>
            </ul>
            <ul class="col-md-3">
                <li>
                    <a class="btn btn-primary"
                       href="{{ url_for('.view_tournament_draw', tournament_id=tournament.id) }}">
                        Voir le tableau
                    </a>
                </li>


                <li>
                    {% if tournament.is_open_to_registration() %}
                        {% if current_user.is_registered_to_tournament(tournament.id) %}
                            {% with participant = current_user.get_participant(tournament.id) %}

                                {% if participant.has_filled_draw() %}
                                    <a class="btn btn-primary"
                                       href="{{ url_for('.edit_my_draw', tournament_id=tournament.id, participant_id=participant.id) }}">
                                        Modifier mon tableau
                                    </a>
                                {% else %}
                                    <a class="btn btn-primary"
                                       href="{{ url_for('.fill_my_draw', tournament_id=tournament.id, participant_id=participant.id) }}">
                                        Remplir mon tableau
                                    </a>
                                {% endif %}

                                <a class="btn btn-primary"
                                   href="{{ url_for('.view_participant_draw', tournament_id=tournament.id, participant_id=participant.id) }}">
                                    Voir mon tableau
                                </a>
                            {% endwith %}

                        {% else %}
                                <a class="btn btn-success"
                                   href="{{ url_for('.register', tournament_id=tournament.id) }}">
                                    Je m'inscris au tournoi
                                </a>
                        {% endif %}
                    {% endif %}
                </li>
            </ul>
            {% if current_user.is_manager() %}
            <ul class="col-md-3">
                <li>
                    {% if tournament.is_open_to_registration() %}
                    <a class="btn btn-warning"
                       href="{{ url_for('.close_registrations', tournament_id=tournament.id) }}">
                        Fermer les inscriptions
                    </a>

                    {% elif not tournament.is_visible() %}
                        {% if not tournament.is_draw_created() %}
                        <a class="btn btn-warning"
                           href="{{ url_for('.create_tournament_draw', tournament_id=tournament.id) }}">
                            Créer le tableau
                        </a>
                        {% else %}
                        <a class="btn btn-warning"
                           href="{{ url_for('.create_tournament_draw', tournament_id=tournament.id) }}">
                            Editer le tableau
                        </a>
                        {% endif %}
                    <a class="btn btn-warning"
                       href="{{ url_for('.open_registrations', tournament_id=tournament.id) }}">
                        Ouvrir les inscriptions
                    </a>
                    {% else %}
                    <a class="btn btn-warning"
                       href="{{ url_for('.open_registrations', tournament_id=tournament.id) }}">
                        Réouvrir les inscriptions
                    </a>
                    {% endif %}
                </li>
            </ul>
            <ul class="col-md-3">
                <li>
                    <a class="btn btn-warning"
                       href="{{ url_for('.edit_tournament', tournament_id=tournament.id) }}">
                        Editer le tournoi
                    </a>
                </li>
                <li>
                    <a class="btn btn-danger"
                       href="{{ url_for('.delete_tournament', tournament_id=tournament.id) }}">
                        Supprimer le tournoi
                    </a>
                </li>
            </ul>
            {% endif %}
        </div>
    </div>
</div>


<div class="panel panel-default panel-table">

    <div class="panel-heading">
        <h3 class="panel-title"><strong>Participants</strong></h3>
    </div>

    <div class="panel-body">

        {% if tournament.participants %}
            <table class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Pseudo</th>
                        <th>Date d'inscription</th>
                        <th>Tableau</th>
                    </tr>
                </thead>
                <tbody>
                    {% for participant in tournament.participants %}
                        <tr>
                            <th>{{ participant.user_id }}</th>
                            <th>{{ participant.user.username }}</th>
                            <th>{{ participant.created_at }}</th>
                            <th><a href= '{{ url_for(".view_participant_draw", tournament_id = tournament.id, participant_id = participant.id, _external = True) }}'>Tableau</a></th>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            Aucun participant à ce tournoi pour le moment
        {% endif %}
    </div>
</div>

{% endblock %}
